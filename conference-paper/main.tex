\RequirePackage{fix-cm}
\documentclass[conf]{new-aiaa}

\usepackage[utf8]{inputenc}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{siunitx}
\sisetup{group-separator = {,}}
\usepackage{booktabs}
\usepackage{enumitem}
\usepackage{float}
\usepackage{amsmath}
\usepackage[version=4]{mhchem}
\usepackage{longtable,tabularx}
\usepackage{placeins}
\usepackage{multirow}
\usepackage{booktabs}
\usepackage{latexsym}
\usepackage{subcaption}
\usepackage{latexsym}
\usepackage[sort&compress,numbers]{natbib} % For bibtex \citet, \citep
\usepackage{hypernat} % To get natbib to play nicely with hyperref
\usepackage{doi} % For getting hyperlinked DOI in the references


\hypersetup{
    pdfauthor={Peter Atma}, % insert author here
	pdftitle={Aviation 2023 Paper}, % insert title here
	pdfsubject={Comparing Hydrogen and Jet-A for an N+3 Turbofan with Water Recirculation using Gradient-Based Optimization}, % insert keywords here
}

\graphicspath{{../figures/}}

% [x] TODO: AL-PA, Consider changing the title to "Comparing Hydrogen and Jet-A for an N+3 Turbofan with Water Recirculation using Gradient-Based Optimization"
\title{Comparing Hydrogen and Jet-A for an N+3 Turbofan with Water Recirculation using Gradient-Based Optimization} % change
\author{Peter N. Atma\footnote{MSE Student, Department of Aerospace Engineering, AIAA Student Member}}
\author{Andrew H~.R.~Lamkin\footnote{Ph.D.~Candidate, Department of Aerospace Engineering, AIAA Student Member}}
\author{Joaquim R.~R.~A.~Martins\footnote{Professor, Department of Aerospace Engineering, AIAA Fellow}}
\affil{University of Michigan, Ann Arbor, MI, 48109}


% ==================================================
%	OVERALL TODOS
% ==================================================
% [ ] TODO: AL-PA, Need to add equation labels
% [ ] TODO: AL-PA, When you are citing things you should include a "~" to link the citation to the text.  i.e, "OpenMDAO~\cite{Gray2019a}" (See my edits in the introduction)
% [ ] TODO: AL-PA, You should also use the "~" to link all equation, figure, and table references to the text.
% [ ] TODO: AL-PA, Make sure all acronyms and subscripts that are longer than a single letter or represent words are shown as text using \rm{} in math mode

\begin{document}

\maketitle

% ==================================================
%	Abstract
% ==================================================
\begin{abstract}
    Advances in commercial propulsion technology led to the development of efficient high bypass ratio turbofan engines with larger overall pressure ratios and internal temperatures.
    Current trends suggest that geared ultra high bypass ratio turbofans are the next generation of commercial propulsion systems.
    Furthermore, the emphasis on decreasing emissions has driven the exploration of hydrogen-powered aircraft, adding to the already challenging design space.
    % With the focus on reducing aircraft emissions, aircraft and engine manufacturers have been pushing for hydrogen as a fuel and more efficient engines to lower carbon emissions.
    Carrying and burning hydrogen introduces complexity and weight penalties that we must offset using the fuel's thermodynamic and chemical properties.
    In this study, we create a closed-loop water recirculation system with a zero-dimensional thermodynamic model and compare the benefits between jet-A and hydrogen fuels.
    We perform a gradient-based optimization parameter sweep to explore the trade-offs between performance and emissions using both fuels with water recirculation.
    The results quantify the design space for next-generation propulsion concepts that can take advantage of hydrogen fuel's advantageous thermodynamic properties to reduce emissions and improve performance.
\end{abstract}

\section{Introduction}
% Message 1: Motivation to incorporate low-emission fuels and techniques
The effects of climate change are pushing the aviation industry towards hydrogen-fueled propulsion systems as a solution to reduce emissions.
N+3 technology estimates for turbofan engines that burn hydrocarbon fuels suggest that higher efficiency can be achieved by designing ultra high bypass ratio (UHBR) engines with small cores and high overall pressure ratios (OPR).
Higher OPR and smaller cores challenge the limits of compressor and turbine design, placing an upper bound on potential performance and emissions improvements.
Switching to hydrogen as the primary fuel source reduces carbon dioxide emissions immediately, but adds complexity and weight that offset the benefits.
However, hydrogen is a versatile fuel with advantageous chemical and thermodynamic properties that can be exploited to increase the performance and reduce emissions.
We introduce a closed-loop water recirculation model that demonstrates the possible efficiency gain when hydrogen is used for purposes other than combustion.
% In this study, we investigate the tradeoff between burning hydrocarbon fuels like Jet-A versus hydrogen for UHBR ratio turbofan engines.
% We will look at new ideas with water recirculation to further squeeze performance and efficiency from Jet-A and hydrogen combustion using gradient-based design optimization.
% [ ] TODO: PA-PA, add section about MAUD and cite.

% Message 2: Background and references to support using H2 and water injection in HBTF engines
% [ ] TODO: AL-PA, Need to find a journal/conference paper to cite for the following statement.  Maybe find one or more papers other than just the NASA report?
Water recirculation is the process of extracting water from the exhaust stream of a propulsion system and injecting it upstream of the combustor as finely atomized droplets.
NASA, Boeing, and Rolls-Royce studied this concept and suggested that this technique reduces the NOx emissions as much as 47 percent~\cite{Daggett2010}.
Additionally, water recirculation improves fuel efficiency and thrust output with lower combustion temperatures that can improve the lifetime of turbine blades and reduce noise~\cite{Daggett2010}.
% [ ] TODO: AL-PA, Should try to find a citation for this if one exists.
Traditional propulsion systems that burn hydrocarbon fuels would require external water storage on the aircraft because they do not produce enough in the exhaust for recirculation.
The added weight of tanks, pumping, and ducting makes this concept infeasible for a conventional aircraft.
The main product of hydrogen combustion is water vapor and can thus be recovered from the exhaust stream.
Recirculating water vapor from the exhaust of hydrogen combustion reduces the requirement for storage tanks and allows for the creation of a closed loop system inside the propulsion cycle.

Zero-dimensional cycle modeling is an efficient tool for predicting the initial design, performance, and emissions of new propulsion concepts.
% [x] TODO: AL-AL, Need to cite CEA paper.
Zero-dimensional analysis uses a first-principles approach with a chemical equilibrium analysis (CEA) thermodynamics solver~\cite{Gordon1994} that considers the molecular species of different fuels.
% CEA can be used to understand the trends and design limitations of an engine cycle and study potential improvements in design using optimization.
The industry standard for thermodynamic cycle analysis is the Numerical Propulsion System Simulation (NPSS) framework~\cite{JonesNPSS}.
NPSS is a modular object-oriented library that models engine components as individual blocks with several thermodynamic solvers.
\citet{Hendricks2019} created a new tool called pyCycle with the same functionality as NPSS with analytical derivatives for each engine component and thermodynamic solver~\cite{Gray2017b}.
pyCycle is built on top of the OpenMDAO framework~\cite{Gray2019a} to enable gradient-based optimization and leverage hierarchical nonlinear solver structures for robustness.

% Message 3: Introduce the extension of the HBTF and propose novel contributions
In this work, we analyze the thermodynamic benefits of a closed-loop water vapor recovery and water injection system in a high-bypass turbofan engine.
We develop pyCycle components for water injection and vapor recovery to quantify the benefit of a closed loop recirculation system.
We use gradient-based optimization to minimize fuel burn subject to performance requirements using both jet-A and hydrogen at a range of flight conditions.
The optimized results show the trade-off between complexity, performance, and efficiency for jet-A and hydrogen fuels.

This work is organized as follows. First, in Section~\ref{sec:method}, we introduce the turbofan model and explain the water injection and water recovery components.
In section~\ref{sec:optprob} the implementation of the multipoint optimization problem is discussed.
Finally, we present the optimized results and discuss the design space in section~\ref{sec:results}.

\section{Methodology}
\label{sec:method}

% Engine Architecture: Describe the flow path of the engine and establish the mechanical coupling.
The UHB turbofan model is the NASA advanced technology "N+3" engine \cite{Jones2017a}.
The N+3 reference cycle represents a UHB ratio geared turbofan that could be available in the 2030 to 2040 time frame.
% We selected the N+3 model because it has already been modeled in pyCycle as a robust example cycle and includes the advanced engine cycle improvements such as a large bypass ratio, high pressure ratio, and high combustion temperature.
The flow path consists of an inlet that directs ambient air through a fan, followed by a duct that splits the flow into a core and a bypass stream, each ending in a core and bypass nozzle, respectively.
The low pressure system is split into two mechanical subsystems.
First, the fan is connected to the gearbox that reduces the shaft speed to decrease the fan tip speeds.
Second, the gearbox attaches to the low-pressure shaft that connects to the low-pressure compressor (LPC) and low-pressure turbine (LPT).
% The low pressure system consists of a fan connected to a gearbox that attaches to the lo and low pressure compressor (LPC) are connected to the low pressure turbine (LPT) by the low pressure shaft.
The high pressure compressor (HPC) is connected to the high pressure turbine (HPT) by the high pressure shaft.

% [x] TODO: AL-PA, potentially move the commented line below about CEA into the subsection discussing the propulsion model.  I think it's too much detail for the setup of this section.
% Thermodynamic equations of state are solved using CEA at the interface between components, shown as black arrows in Figure~\ref{fig:n3_cycle}.
We introduce the closed-loop water recovery system as a feedback loop that transports water from the exhaust to upstream of the compressors.
% The closed-loop water recovery system is implemented into the cycle by placing a water injection component directly before the HPC.
The recovery system injects vaporized water into the core stream that reduces the combustion temperature due to heat absorption.
The vapor recovery component is placed directly before the core nozzle to extract water from the exhaust and recycle it back to the injector.
% NOTE: AL-PA, don't discredit your work before you even explain the model and methods.  We can make this point in the results or conclusion.
% In practice a water vapor recovery component requires a complex condenser model in the core stream, this work will only look at the potential benefits of extracting water vapor and not the recovery method specifically.

In this section we present the full engine layout and provide details on the multipoint zero-dimensional modeling approach.
We explain the implementation and assumptions of the water recovery model and the coupling with the thermodynamic cycle.
% The component flow interface and mechanical connections, including the water injector and water extractor, are depicted in Figure \ref{fig:N3_original}.
% The propulsion model is constructed in pyCycle which is built on top of OpenMDAO to allow a modular design of the engine components and the coupling of other engineering disciplines for analysis \cite{Gray2019a}.
% The engine model that was selected for this project is the NASA advanced technology UHB geared turbofan engine cycle, referred to as the "N+3" engine \cite{Jones2017a}.
% The N+3 reference cycle represents a UHB ratio geared turbofan that could be available in the 2030–2040 time frame and was selected since it has already been modeled in pyCycle as a robust example cycle and includes the advanced engine cycle improvements such as a large bypass ratio, high pressure ratio, and high combustion temperature.
% The flow path consists of an inlet that directs ambient air through a fan, followed by a duct that splits the flow into a core flow and a bypass flow, each of which ends in a bypass nozzle and core nozzle, respectively.
% The fan and low pressure compressor (LPC) are connected to the low pressure turbine (LPT) by the low pressure shaft and the high pressure compressor (HPC) is connected to the high pressure turbine (HPT) by the high pressure shaft.
% Along the axial flow path, the zero-dimensional thermodynamic connections are solved using CEA to ensure the first principle governing equations are satisfied.
% Figure \ref{fig:N3_original} shows how the 25 elements in the N+3 cycle are connected together with the fluid flows in blue, the mechanical connections in red, and the performance elements in green \cite{Hendricks2019}.

\subsection{Propulsion Model}
The N+3 model is implemented in pyCycle~\cite{Hendricks2019}, a zero-dimensional thermodynamic cycle modeling library with analytical gradients.
Zero-dimensional models are a collection of components that combine to form a unified thermodynamic cycle.
The N+3 UHB geared turbofan model consists of twenty-five different elements that define the flow path and the mechanical systems.
Thermodynamic quantities are solved and exchanged using CEA at flow path boundaries represented by black arrows between blue flow path components in Figure~\ref{fig:N3_original}.
The fan, gearbox, low pressure, and high pressure systems are connected by three mechanical shafts depicted in red in Figure~\ref{fig:N3_original}.

% Three mechanical shafts, depicted in red in Figure~\ref{fig:N3_original}, connect the fan, low pressure, and high pressure systems.

We impose \emph{balance} equations on the cycle to satisfy the physical governing equations, conservation laws, and design rules.
\emph{Balance} relationships are formulated as equations in the form $r(u)=0$ where $r$ is a residual function and $u$ is an implicit state variable.
We use Newton based solvers to find the value of the state variables that drive the set of balance residuals to zero.
\citeauthor{Hendricks2019} provide the balance equations for the N+3 engine model and further detail the cycle setup.


% [x] TODO: AL-PA, Remove the black box with the component descriptions from the bottom left of the figure.
% [x] TODO: AL-PA, Add the description of the figure elements to the caption.
% [x] TODO: AL-PA, Consider changing the caption to "Simplified layout of the N+3 engine cycle, adapted from~\citet{Hendricks2019}"
% [x] TODO: AL-PA, Remove the flight conditions component and add the bypass duct component below the splitter. I think the bypass is an important enough aspect of the engine to include.
\begin{figure}[hbt!]
    \centering
    \includegraphics[width=1.0\textwidth]{N3_cycle.pdf}
    \caption{
        Simplified layout of the N+3 engine cycle, adapted from~\citet{Hendricks2019}.
        Black arrows are flow connections, red lines are mechanical connections, blue boxes are cycle elements, red boxes are shaft elements.
    }
    \label{fig:N3_original}
\end{figure}

% In pyCycle, the Cycle block contains all of the governing thermodynamic equations needed to model an engine such as CEA analysis, compressor and turbine models, and equations of state.
% These equations allow any arbitrary engine design to be assembled using the modular cycle elements.
% The Cycle block itself may not result in a valid model of the engine since some physical dependencies may not match.
% These physical dependencies are handled by the Balance block which solves a set of implicit state variables and nonlinear physical residual equations in the form:

% \noindent
% where $x_i$ is some physical variable such as a mass or energy flow rate.
% These residuals represent the physical conservation laws such as mass flow rate are converged to zero by the Solver.
% In pyCycle, a direct solver is used for linear equations and a Newton solver is used for nonlinear equations which utilizes the analytic partial derivatives provided by each OpenMDAO component.
% All residuals within the engine model are converged at the Cycle level for a given operation condition since all of the parameters downstream do not directly effect those upstream.
% However, with introducing the extractor and injector components, we add a feedback loop into the model where mass is removed downstream and added upstream.
% Therefore, the mass flow rates residuals of the closed-loop vapor recovery system shown below would need to be converged in the Multipoint Cycle explained in the next section.

% \begin{equation}
%     \mathcal{R}_{c,\dot{m}} = \dot{m}_{extractor} - \dot{m}_{injector} = 0
% \end{equation}

\subsection{Water Recovery Model}
We implemented the closed-loop water recovery system as a feedback system that extracts water from the exhaust stream and injects it upstream of the HPC.
% The closed-loop water recovery system is implemented into the cycle by placing a water injection component directly before the HPC.
% This component will inject pure water into the core stream which will reduce the combustion temperature due to heat absorption from vaporization.
We chose this injection location based on claims from a study by NASA, Boeing, and Rolls-Royce~\cite{Daggett2010} that water injection directly into the combustor is unnecessary.
% This location was chosen as it was one of the configurations chosen by the aforementioned NASA, Boeing, and Rolls-Royce study that did not require direct combustor injection \cite{Daggett2010}.
The water vapor recovery component sits downstream of the LPT and extracts water from the flow before it exits the core nozzle.
% The water vapor recovery component is placed directly before the core nozzle to extract water from the core stream and recycle it back to the water injector.
% Water is recovered from this location as it is the last possible location before the nozzle in which water can be extracted.
% [x] TODO: AL-PA, add a sentence about the assumptions for the vapor recovery instead of the mentioning the condenser
In the model of the extractor, we are assuming that a fraction of the total water available in the exhaust stream is recovered and that there are no pressure or temperature losses associated with this process.
% NOTE: AL-PA, we will talk about the condenser when we discuss the results of the pressure recovery parameter sweep.
% In practice a water vapor recovery component requires a complex condenser model in the core stream, this work will only look at the potential benefits of extracting water vapor and not the recovery method specifically.
The component flow interface and mechanical connections, including the water injector and water extractor, are depicted in Figure \ref{fig:n3_cycle}.

\begin{figure}[hbt!]
    \centering
    \includegraphics[width=0.75\textwidth]{turbofan_wvr.pdf}
    \caption{
        The configuration of a high-bypass turbofan model with an integrated closed-loop water vapor recovery and injection system.
        The water vapor recovery system (extractor) extracts a fraction of the water in the core stream and reinjects it upstream of the high-pressure compressor.
        This diagram illustrates the feedback effect that this implementation has on the overall core flow.}
    \label{fig:n3_cycle}
\end{figure}

To account for the humidity of the inlet air as well as the increased humidity after water injection, we modified the composition of the air mixture upstream of the combustor.
% Since water is being used in the sections of the engine upstream of the combustor, this model was designed to take the humidity of the air into account.
% To utilize water engine section infront of the combustor the N+3 engine model had to be modified to include $H_2O$ as a species.
pyCycle provides a \texttt{wet-air} dataset that introduces $\mathrm{H_2O}$ molecules to the composition of air.
% The \texttt{wet-air} dataset inherits the NPSS \texttt{JANAF} data from the original model but removes a couple troublesome hydrocarbons from the product species as they can cause numerical issues.
% The FlightConditions() pyCycle subsystem can then have a reactant and mixture ratio specified when implemented.
We prescribe atmospheric mass-specific humidity as a water-to-air ratio (WAR) that is defined as the ratio of $\mathrm{H_2O}$ to air in the reactants of the inflow mixture.
% In this case, the reactant is be $H_2O$ and the mixture ratio is the water-to-air (WAR) ratio of the water content in the air.
% The WAR is the sp of the air expressed in equal units and separating out the total mass (kg water/kg air).
\citet{Kalnay1996} give the humidity values for each flight condition.
% The humidity values used in this paper are from a NOAA dataset \cite{Kalnay1996}.

We introduce two new thermodynamic models for water recirculation in pyCycle.
% To model the complicated water recirculation loop in pyCycle new components had to be developed.
A water injector adds water to the flow upstream of the HPC, while a water extractor diverts a portion of the water in the flow away from the exhaust stream.
% The two models are a water injector that adds water to the flow upstream of the HPC and a water extractor to divert a fraction of the water in the flow away from the exhaust stream.
The injector operates similarly to fuel injection in the pyCycle combustor component.
We determine a WAR that is analogous to the fuel-to-air (FAR) ratio in the combustor.
% The injector component is based on the combustor component already included in pyCycle which operates by injecting a given fuel-to-air ratio (FAR) or fuel flow rate to determine the mass of fuel added to the incoming flow.
This WAR is used to compute the chemical species present in the flow at the current thermodynamic state, determined by the incoming flow.
The new species composition and thermodynamic state are determined using the pyCycle CEA solver~\cite{Gray2017b}.
% Once the new composition is determined, the various thermodynamic variables are passed to the next component in the engine.
% The water injector component would inject water as a reactant instead of the fuel as the combustor would.
The water injector inputs are the mass flow rate and mass fraction of water.
We can solve for the mass flow rate on a mixture basis using the WAR, or directly by specifying the mass flow rate of water.
% The water injector can take either water-to-air ratio (WAR) or water mass flow rate to determine how much water is added to the flow.
A schematic of the injector is shown in Figure \ref{fig:injector} where $Y_{H_2O}$ is the mole fraction of water molecules.

\begin{figure}[hbt!]
    \centering
    \includegraphics[width=0.75\textwidth]{injector.pdf}
    \caption{
        Injector component schematic.
        Water from the extractor is simply injected into the core flow upstream of the high-pressure compressor.
    }
    \label{fig:injector}
\end{figure}

The water extractor model diverts a fraction of a specific species from one flow path to another.
% The water extractor model is based on an air-bleed component in pyCycle with the added complexity of extracting a fraction of a specific species within the flow.
The CEA solver calculates the inflow composition and the extractor separates a specific species based on a mass fraction input.
The composition of the core stream is updated to represent the remaining mixture after the extractor model removes the desired species from the incoming flow.
We then solve for the thermodynamic state and flow path areas at the outflow of both extractor streams.
% The extraction determines the water content of the incoming flow and extracting a given fraction of that water flow.
% The water content of the incoming flow is determined by solving a CEA analysis of the incoming flow.
% This water content in the incoming flow is then used with a given fraction of the water to extract to determine the how much water mass flow to remove from the stream.
% The outputs of the extractor component are the flow rate of the core flow and the corresponding flow properties in addition to the extracted water mass flow rate.
% While this process certainly would have pressure loss penalties in terms of condensing water in a condenser, this project just looks at the effects of water recovery since there are no current models for nozzle exhaust condensers available.
A simple schematic of the extractor is shown in Figure \ref{fig:extractor} where $Y_{H_2O}$ is the mole fraction of water molecules and $X_{H_2O,k}$ is the fraction of water that is recovered from the core stream.

\begin{figure}[hbt!]
    \centering
    \includegraphics[width=0.75\textwidth]{extractor.pdf}
    \caption{
        Extractor component schematic.
        A certain mole fraction of the flow coming out of duct5 is comprised of water of which a certain specified fraction is extracted.
        The extracted water is routed back upstream to the injector and the rest is simply exhausted out the nozzle.
    }
    \label{fig:extractor}
\end{figure}

We connect one outflow stream of the extractor to the inflow stream of the injector to complete the water recirculation system.
The model results in a mismatch between the mass flow rate upstream of the HPC and the mass flow rate exiting the core nozzle.
To preserve conservation of mass, we treat the water recirculation as a nonlinear cycle that must converge before the engine calculation is physically balanced.
In this model, we are assuming the water molelues are removed from the exhaust stream with no pressure or temperature losses.
Additionlly, the model assumes the injected water molecules are at the same pressure and temperature as the air flow just before the HPC.
Therefore, we are just capturing the effect of adding pure water to the stream since zero-dimentional analysis cannot reproduce the effect of evaporation.
% This is because the pyCycle model is solved sequentially component to component during each Newton iteration.
% So a Nonlinear Block Gauss-Seidel solver would be sufficient to solve this feedback loop.
% However, the N+3 model already has a nonlinear Newton solver at the Multipoint Design level, so the extractor mass flow rate and injector mass flow rate variables are connected for each design point and use this nonlinear solver to converge the water streams.
We illustrate the water recirculation loop and the nonlinear solver connections in Figure \ref{fig:N3_xdsm_full}.

\begin{figure}[hbt!]
    \centering
    \includegraphics[width=1.0\textwidth]{N3_CLVR_cycle.pdf}
    \caption{
        Simplified layout of the N+3 engine cycle with the closed-loop vapor recovery.
        Black arrows are flow connections, red lines are mechanical connections, blue boxes are cycle elements, red boxes are shaft elements.
    }
    \label{fig:n3_clvr}
\end{figure}

\subsection{Multipoint Model}
% NOTE: AL-PA, I added this blurb to introduce multipoint
We operate the engine cycle in different modes depending on the desired conservation relationships, design rules, and flight conditions.
In ``on-design'' mode, we prescribe important cycle inputs such as turbo machinery efficiencies, pressure ratios, and combustion temperatures.
The ``off-design'' mode inherits the flow path areas and turbo machinery map scalars from the ``on-design'' analysis.
We enforce design rules as balance equations between different design points to consider the performance of the engine cycle at limiting flight conditions.
Table \ref{flight_conds} shows the different altitudes and mach numbers at each flight condition.



The ``on-design'' point is top-of-climb (TOC) with ``off-design'' conditions at rolling takeoff (RTO), sea-level static (SLS), and cruise (CRZ).
Each flight condition is either critical to the performance or limits the design of the engine.
% [x] TODO: AL-PA, You should explain why each design point is important in a separate sentence for each.
%   - For example, the SLS point is important for making sure the turbo machinery and flow paths are designed to meet a static thrust target
%   - The RTO point is limiting for temperature, etc...

% [x] TODO: AL-PA, Consider re-writing this section using the comments from the previous TODO.  Be more concise and direct with the language here.
The N+3 engine model has many complex thermodynamic and performance connections between the different operating conditions such as temperature ratios and cooling requirements.
Therefore, the N+3 engine model computes the engine performance at the four different operating conditions in order to resolve these connections.
% The operating conditions that considered are top-of-climb (TOC), rotating takeoff (RTO), sea-level static (SLS), and cruise (CRZ).
% [x] TODO: AL-PA, This is a big run-on sentence.  Consider breaking it up and being more specific about the requirements at each design point.  See previous comments.
The SLS operating condition is important for ensuring that the turbomachinery and flow paths are designed to a meet static thrust target.
The RTO operating condition is important for specifying the upper limit of the combustor temperature and cooling requirements for a thrust target during take-off.
The TOC operating condition is important for specifying the required thrust during the climb at the design altitude.
Finally, the CRZ operation condition is important for specifying that the turbomachinery and flow paths are designed to meet cruise target thrust.
To account for each of these operating conditions, the N+3 model uses a technique called Multipoint Design Point (MDP) modeling to converge the model to an engine design.
This final design must satisfies the requirements at each of these operating conditions.
The altitude and mach number of each of the operating conditions is shown in Table \ref{flight_conds}.

% [x] TODO: AL-PA, Add a small table to show the mach and altitude of each flight condition
\begin{table}[hbt!]
    \centering
    \caption{Altitude and mach numbers at each of the flight conditions considered in the multipoint formulation.
    }
    \begin{tabular}{l r r r r l}
        \hline
        Parameter      & TOC     & RTO   & SLS   & CRZ     & Units      \\
        \hline
        Altitude       & 35000   & 0     & 0     & 35000   & \si{ft}    \\
        Mach           & 0.8     & 0.25  & 0.0   & 0.8     & -          \\
        Humidity Ratio & 0.00017 & 0.009 & 0.009 & 0.00017 & \si{kg/kg} \\
        \hline
    \end{tabular}
    \label{flight_conds}
\end{table}

% NOTE: AL-PA, Using a lot of extra words to say: "The TOC point is the on-design condition."
The TOC point is the ``on-design'' condition since it is desireable to specify combustor temperatures and pressure ratios at this point.
% NOTE: AL-PA, The design point sizes the flow paths and scales the turbo machinery.  The off-design has the exact same flow path as the design mode cycle.  The turbo machinery maps are scaled using scalar quantities for off-design performance.
% [x] TODO: AL-PA, Don't say "generally" or "essentially" because it makes the method appear ambiguous.
The design point for the model sets all of the engine sizing such as areas and pressure ratios across components.
The off-design points inherit the size of the engine in terms of the cross-sectional areas from the design point but operate at the corresponding required thrust, cooling, and environmental conditions.
% [ ] TODO: AL-PA, We don't need to talk about the Newton or linear solver details.  Just explain the multipoint model structure with the Newton solver added for context.
% The design point of the engine model is converged using a linear Newton solver which then passes the geometric sizing variables such as cross-sectional areas and map scalars to the off-design points and similarly converges those.
% Then, a nonlinear Newton solver is used to converge the overall model with respect to the variable connections between each operating condition.
% An XDSM diagram of the nominal N+3 engine model is shown in Figure \ref{fig:N3_xdsm} \cite{Hendricks2019}.

% [x] TODO: AL-PA, I would remove this figure.  Not adding anything more than the detailed XDSM you provide later.

% [x] TODO: AL-PA, Don't talk about the objective function until the optimization problem section.
% [x] TODO: AL-PA, Move the discussion about TSEC to the results.  You don't need to introduce the equation here because it has nothing to do with the details of the multipoint model.
% Our comparison metric is $TSEC_{CRZ}$ but minimizing $\dot{m}_{fuel}$ is a better posed optimization problem since we will also have thrust constraints.
% [x] TODO: AL-PA, Again, move this to the optimization problem section.  You should also try to make this sentence more concise.
% Therefore, the water mass fraction that will most impact the objective function the most is at the CRZ operating condition and we thus want to size the area of the injector and extractor at CRZ instead of TOC like the rest of the areas are.
% [x] TODO: You shouldn't say things "normally" occur.  Just tell the reader what you did.
% I suggest re-writing this to plainly explain why we size the water recirculation at cruise instead of TOC
% Example: We size the water recovery system at cruise because it is the most important phase for fuel burn reduction. etc...
% The cross-sectional areas are set at the design point (TOC) and are connected to the off-design points.
We size the water recovery system at the cruise condition because it is the longest and most important phase of flight for fuel burn reduction.
To size the areas of the injector and extractor at CRZ, we only connect the thermodynamic state variables across these components at the corresponding operating condition and set the areas of both components at the CRZ point.
These connections are shown graphically in the XDSM diagram in Figure \ref{fig:N3_xdsm_full}.

% Explain Exit ratios and how BPR and OD net thrusts are set
% [x] TODO: AL-PA, I would include all four of the balance components here and explain how they effectively act as constraints on the multipoint model.
% NOTE: AL-PA, See the pyCycle paper, they explain how using the balance residuals creates a reduced design space for the optimization problem.
% NOTE: AL-PA, You can discuss how this makes the multipoint nonlinear solution more challenging, but improves the optimization problem conditioning.
The N+3 multipoint model has many constraints on the model that set conservation and design values using \emph{balance} components.
A Newton solver is used to converge these conservation an design values such $r=0$.
The conservation \emph{balance} residuals are associated with each of the three shafts at each design condition.
The state variables that set the shaft conservation residuals are the turbomachinery pressure ratios ($PR_{Fan}$, $PR_{LPC}$, $PR_{HPC}$) at TOC and shaft speeds ($N_{Fan}$, $N_{LPC}$, $N_{HPC}$) and engine mass flow rate ($\dot{m}$) at the ``off-design'' points.
The design constraints are also set using \emph{balance} residuals.
For the TOC point, $T_{4}$ is set by the fuel-to-air ratio (FAR) of the burner and $OPR$ is set by $HPC_{PR}$.
Additionally, a constraint on the turbomachinery polytropic efficiency is set based on technological assumptions.
These TOC balance residuals are summarized in Equation \eqref{des_resid} \cite{Hendricks2019}.

\begin{equation}
    r_{des} \rightarrow
    \begin{cases}
        T_{4,TOC} = T_{4,des}                 \\
        OPR_{TOC} = OPR_{des}                 \\
        \eta_{poly,i,TOC} = \eta_{poly,i,des} \\
    \end{cases}
    \label{des_resid}
\end{equation}

The outputs for the TOC point based on these design constraints are TSFC and $F_{net}$.
For the ``off-design'' points, the target fan stall margin is set by the bypass ratio (BPR) and target net thrust is mainly set by FAR.
Additionally, the engine cooling mass flow rate residuals are set by cooling needs at RTO using a perscibed value.
These ``off-design'' residuals are summarized in Equation \eqref{od_resid} \cite{Hendricks2019}.

\begin{equation}
    r_{od} \rightarrow
    \begin{cases}
        R_{Fan} = R_{Fan,target}      \\
        F_{net} = F_{net,target}      \\
        \dot{m}_{cooling, err, k} = 0 \\
    \end{cases}
    \label{od_resid}
\end{equation}

Solving for all of the state and design variables while satisfying constraints could be accomplish with only an optimizer to simplify the problem.
However, using a solver to converge constraints using \emph{balance} components creates a reduced-space problem with few design variables for the optimizer.
This increases the complexity of the multipoint nonlinear solution but simplifies the problem for the optimizer and is the preferred method in cycle analysis.

In the N+3 model implementation presented in the pyCycle paper, the bypass ratio (BPR) at TOC is computed using a \emph{balance} component.
The \emph{balance} component for $BPR_{TOC}$ uses the exit velocity ratio of the core and bypass nozzles which is given as:

\begin{equation}
    V_{ratio} = \frac{V_{core,ideal}C_{v,core}}{V_{bypass,ideal}C_{v,bypass}}
    \label{vratio}
\end{equation}

\noindent
where $V_{ideal}$ is the exit velocity of a nozzle and $C_v$ is the velocity coefficient of the nozzle which represents non-ideal effects.
This adds a constraint where the core exit velocity is higher than the bypass exit velocity.

% [x] TODO: AL-PA, I'm not sure this subsection is necessary.  We will describe the performance metrics in the optimization problem section.  Consider moving it there.

With all of the sub-models of the N3 engine presented, the complete engine cycle XDSM diagram is shown in Figure \ref{fig:N3_xdsm_full}.
This is the multidisciplinary design analysis block of the model.

% [x] TODO: AL-PA, Already discussed, but this should be the only "fine-detail" XDSM in the paper.
% [ ] TODO: AL-PA, Make the figure use the entire text width so that it's easier to read.  Might have to reposition a bit.
\begin{figure}[hbt!]
    \centering
    \includegraphics[width=1.0\textwidth]{N3_xdsm_full.pdf}
    \caption{
        Full multidisciplinary design analysis (MDA) model N+3 XDSM diagram.
        This XDSM diagram shows the multipoint coupling between the different operation conditions and shows how the water recovery fractions are used to solve for water mass flow rates.
    }
    \label{fig:N3_xdsm_full}
\end{figure}

\section{Optimization Problem}
\label{sec:optprob}

% NOTE: AL-PA, No reason to have an extra subsection here so I removed it
% \subsection{Problem Statment}
% Briefly discuss the optimization problem
% NOTE: AL-PA, "We will perform" makes it seem like we haven't done the work yet.
We performed multipoint gradient-based design optimization of the N+3 engine model considering the TOC, RTO, SLS, and CRZ flight conditions.
% We will perform gradient-based design optimization of the engine model with the multipoint architecture that considers each of the flight conditions experienced by commercial aircraft.
% We will perform a parameter sweep of the limiting constraint to understand the impact of different emissions and performance requirements on the design space.
% NOTE: AL-PA, I re-wrote this to be more direct
The objective is to minimize fuel burn subject to design and performance constraints at each flight condition.
% The objective is to minimize the TSEC since that is our performance metric for comparing the two types of fuels.
% However, since we are constraining net thrust at each operating condition this optimization problem becomes ill-posed.
% Therefore, we will minimize fuel flow rate, $W_{fuel}$ at the cruise condition subject to net thrust and engine diameter constraints since this will accomplish the same goal with a better posed problem.
% [x] TODO: AL-PA, This is a good place to discuss the performance metrics and add the equations for TSEC and explain why it's better for this study than TSFC.

For measuring the efficiency of jet engines, thrust-specific fuel consumption (TSFC) is used in cycle analysis since it represents how much fuel is burned at a given thrust level.
However, when comparing Jet-A and hydrogen fuels this is not such a good metric since a given mass flow rate of hydrogen has an energy content almost 3 times that of Jet-A.
% TODO: Update mdolab.bib
A better metric for comparing the relative efficiencies of an engine running on Jet-A versus hydrogen is thrust-specific energy consumption (TSEC). %\cite{Adler2023}.
TSEC is TSFC multipied by the lower heating value (LHV) of the fuel shown in Equation~\eqref{eq:tsec}.

\begin{equation}
    TSFC = \frac{\Dot{m}_{fuel}}{F_{thrust}}
    \label{eq:tsfc}
\end{equation}

\begin{equation}
    TSEC = \frac{\Dot{m}_{fuel} LHV}{F_{thrust}} = TSFC \times LHV
    \label{eq:tsec}
\end{equation}

Therefore, TSEC at the cruise condition is the objective function in the optimzation problem.
An XDSM diagram of the optimization problem with the multipoint formulation is shown in Figure \ref{fig:N3_opt_xdsm}.

% [x] TODO: AL-PA, simplify this XDSM to show just the optimization setup. Condense the MDA into a single block and remove all the multipoint acronyms.
\begin{figure}[!hbt]
    \centering
    \includegraphics[width=1.0\textwidth]{N3_opt_XDSM.pdf}
    \caption{
        XDSM diagram of the multipoint optimization problem with objective, constraints, and MDA block.
        The XDSM diagram shows the variables and outputs within the optimization model and how each of these values is connected to the optimizer and MDA block.}
    \label{fig:N3_opt_xdsm}
\end{figure}

% [x] TODO: AL-PA, I would elaborate on this a bit more.  Are these the on-design parameters?  Are they constraints?
% [x] TODO: AL-PA, The N+3 model has a bunch of constraints imposed on the multipoint problem via balance comps.  This is a good place to talk about those.
% [x] TODO: AL-PA, Discuss how using balance comps instead of constraints represents a reduced space problem for the optimizer. (See pycycle paper for more information).
The TOC point constraints shown in Figure \ref{fig:N3_opt_xdsm} are only the constraints imposed on the model at optimizer level.


The design variables for this problem are water recovery fraction at CRZ ($X_{\rm{H2O,CRZ}}$), fan pressure ratio ($\rm{PR}_{\rm{fan,TOC}}$), low pressure compressor pressure ratio ($\rm{PR}_{\rm{LPC,TOC}}$), overall pressure ratio at CRZ ($\rm{OPR}_{\rm{TOC}}$), burner temperature at RTO ($T_{4,\rm{RTO}}$), TOC-RTO burner temperature ratio ($T_{4,\rm{ratio}}$), and the nozzle velocity ratio at CRZ ($V_{\rm{ratio,CRZ}}$).
Only the water recovery fraction at CRZ is a design variable since we are optimizing $TSEC_{\rm{CRZ}}$.
TOC-to-RTO burner temperature ratio ($T_{4,\rm{ratio}}$) is shown in Equation \eqref{t4ratio}.
\begin{equation}
    T_{4,\rm{ratio}} = \frac{T_{4,\rm{TOC}}}{T_{4,\rm{RTO}}}
    \label{t4ratio}
\end{equation}

This optimization problem was run for both Jet-A and H2 fuels using the fuel properties in \ref{fuel_props} and flight conditions in Table \ref{flight_conds}.

% [x] TODO: AL-PA, Why are some of the fist words in the descriptions capitalized but not others?  I think this should be consistent.
% [x] TODO: AL-PA, Change the lower heating value references to footnotes. i.e \footnote{\url{...}}
\begin{table}[hbt!]
    \centering
    \caption{
        N+3 model fuel properties.
        The lower heating values are given for each fuel used to compute TSEC.}
    \begin{tabular}{r r r l}
        \hline
        Parameter              & Value   & Units        & Description                                                                                                            \\
        \hline                                                                                                                                                                   \\
        $\rm{LHV}_{\rm{JetA}}$ & 18564.0 & \si{BTU/lbm} & Lower heating value of Jet-A \footnote{\url{https://www.smartcockpit.com/docs/Jet_Fuel_Characteristics.pdf}}           \\
        $\rm{LHV}_{\rm{H2}}$   & 51591.0 & \si{BTU/lbm} & Lower heating value of H2 \footnote{\url{https://www.engineeringtoolbox.com/fuels-higher-calorific-values-d_169.html}} \\
        \hline
    \end{tabular}
    \label{fuel_props}
\end{table}

The optimization problem objective function, design variables, and constraints are shown in Table \ref{tab:opt_problem} below.

% [x] TODO: AL - PA, Define the T4 ratio with an equation and reference the equation in the table
% [x] TODO: AL-PA, I thought we were only doing recovery fractions at CRZ??
% [x] TODO: AL-PA, Make sure you reference the equations for the DVs/cons in the descriptions so the reader can connect them.
\begin{table}[hbt!]
    \centering
    \caption{
        Multipoint optimization problem definition.
        The objective function is the thrust specific energy consumption at the cruise condition.
        The constraints are net thrust and engine diameter constraint at the design point, TOC.
    }
    \small
    \renewcommand{\arraystretch}{1.2}
    \begin{tabular}{r l l r l}
        \toprule
                        & Variable/Function              & Description                                                           & Units          & Quantity \\
        \hline
        minimize        & $TSEC_{\rm{CRZ}} $             & Thrust-specific energy consumption at CRZ (Equation \eqref{eq:tsec})  & \si{lbm/s}     & 1        \\
                        &                                &                                                                       &                &          \\
        with respect to & $X_{\rm{H2O,CRZ}}$             & Water recovery fraction at CRZ                                        & -              & 1        \\
                        & $\rm{PR}_{\rm{fan,TOC}}$       & TOC fan pressure ratio                                                & -              & 1        \\
                        & $\rm{PR}_{\rm{LPC,TOC}}$       & TOC low-pressure compressor pressure ratio                            & -              & 1        \\
                        & $\rm{OPR}_{\rm{TOC}}$          & TOC overall pressure ratio                                            & -              & 1        \\
                        & $T_{4,\rm{RTO}}$               & RTO combustor temperature                                             & \si{\degree R} & 1        \\
                        & $T_{4,\rm{ratio}}$             & TOC-to-RTO temperature ratio (Equation \eqref{t4ratio})               & -              & 1        \\
                        & $V_{\rm{ratio,CRZ}}$           & Core-to-bypass nozzle velocity ratio at CRZ (Equation \eqref{vratio}) & -              & 1        \\
        \cline{3-5}
                        &                                & Total                                                                 &                & 7        \\
                        &                                &                                                                       &                &          \\
        subject to      & $F_{\rm{net,TOC}} \geq 5800.0$ & Target net thrust at TOC                                              & \si{lbf}       & 1        \\
                        & $D_{\rm{fan}} \leq 100$        & Maximum Fan Diameter                                                  & \si{inch^2}    & 1        \\
        \cline{3-5}
                        &                                & Total                                                                 &                & 2        \\
        \bottomrule
    \end{tabular}
    \label{tab:opt_problem}
\end{table}

% Blurb about PyOptSparse and SNOPT
% NOTE: AL-PA, This can all be part of the optimization problem section you don't need a new subsection
% \subsection{Optimization Software}
% NOTE: AL-PA, "pyOptSparse" not "PyOptSparse", i.e the first "p" is not capitalized.
% [x] TODO: AL-AL, need to cite pyOptSparse, SNOPT, and OpenMDAO
% NOTE: AL-PA, I re-wrote most of this to be more concise.
OpenMDAO~\cite{Gray2019a} is a modular framework that enables multidisciplinary gradient-based optimization with analytic coupled derivatives.
We use pyOptSparse~\cite{Wu2020a} to facilitate the use of state-of-the-art optimization software through a unified python interface.
We solve the optimization problem listed in Table~\ref{tab:opt_problem} with SNOPT~\cite{Gill2005a}, a gradient-based sequential quadratic programming (SQP) algorithm for large-scale constrained problems.

% OpenMDAO supports the use of different optimization packages including Scipy and PyOptSparse.
% PyOptSparse is an object-oriented framework for formulating and solving nonlinear constrained optimization problems.
% PyOptSparse was chosen as the main optimization package for this problem due to its wide range of open-source gradient-based optimizers and integration with  \cite{Wu2020a}.

% SNOPT (Sparse Nonlinear OPTimizer) was the optimizer chosen for this work.
% SNOPT is a state-of-the-art optimizer used to solve large-scale optimization problems (linear and nonlinear).
% The software uses a sparse SQP (sequential quadratic programming) algorithm with a limited-memory quasi-Newton approximation to the Hessian of the lagrangian.
% SNOPT is particularly useful for nonlinear problems whose functions and derivatives are expensive compute.
% An augmented Lagrangian merit function ensures convergence from an arbitrary point.
% SNOPT allows the nonlinear constraints to be violated (if necessary) and minimizes the sum of these violations.
% Due to the robustness of the algorithm, SNOPT is a perfect optimizer to solve the highly complex Multipoint systek since the pyCycle engine cycle would occasionally reach a point that is non-physical and would thus cause the solver to fail.
% SNOPT is able to respond to these solver failures and backtrack to a region in the design space that is physical and continue the optimization \cite{Gill2005a}.

\section{Results}
\label{sec:results}

Our comparison metric is $TSEC$ but minimizing $\dot{m}_{fuel}$ is a better posed optimization problem since we will also have thrust constraints.
Therefore, the fuel flow rate at CRZ, $\dot{m}_{fuel,CRZ}$, was set as the objective.

When $T4_{RTO}$ and $X_{\rm{H2O,CRZ}}$ are design variables at the same time it was found that the optimizer pushes $T4_{RTO}$ down and $X_{\rm{H2O,CRZ}}$ up.
Since these two variables are at odds with each other and the upper limit for $X_{\rm{H2O,CRZ}}$ is where the model breaks, $T4_{RTO}$ was set as the optimal value from the optimizations with no water recirulation.

The 4 optimizations mentioned in the optimation problem section were run and solved.
The optimality, feasibility, and merit function for each optimization is shown plotted in Figure \ref{fig:history_summary}.

% Feasibility, Optimality, Merit Func history
\begin{figure}[hbt!]
    \centering
    \includegraphics[width=0.8\textwidth]{opt_summary.pdf}
    \caption{The optimality, feasibility, and merit fuction history for each optimization problem.
        Jet-A without water recovery is shown with the solid lines, the Jet-A with water recovery is shown with dashed lines, hydrogen without water recovery is shown with dash-dot lines, and hydrogen with water recovery is shown with dotted lines.}
    \label{fig:history_summary}
\end{figure}

From this plot we can visually check that each optimization achieved optimality and feasibility, and that the merit function reached a steady-state value.

% DV history
% NOTE: PA-AL, will update this plot with Vratio starting at 1.4 so it doesn't start right at the optimal value of 1.35
\begin{figure}[hbt!]
    \centering
    \includegraphics[width=0.8\textwidth]{dvs.pdf}
    \caption{The design variable history for each optimization problem.
        Jet-A without water recovery is shown with the solid lines, the Jet-A with water recovery is shown with dashed lines, hydrogen without water recovery is shown with dash-dot lines, and hydrogen with water recovery is shown with dotted lines.}
    \label{fig:history_dvs}
\end{figure}

% Constraint history
\begin{figure}[hbt!]
    \centering
    \includegraphics[width=0.8\textwidth]{cons.pdf}
    \caption{The constraint history for each optimization problem.
        Jet-A without water recovery is shown with the solid lines, the Jet-A with water recovery is shown with dashed lines, hydrogen without water recovery is shown with dash-dot lines, and hydrogen with water recovery is shown with dotted lines.}
    \label{fig:history_cons}
\end{figure}

% Results of optimization problems
The optimization problems with both types of fuel but no water recovery ran smoothly and finished with 0/1 SNOPT exit codes meaning that the optimization finished successfully and met the optimiality conditions.
The resulting values of the optimization problems is shown in Figure \ref{fig:parallel_coords}.
% The resulting values of the optimization problem for Jet-A and hydrogen without water recovery are shown in Tables \ref{tab:res_thermo_opt_JetA} and \ref{tab:res_thermo_opt_H2}, respectively.
% Similarly, the resulting values of the optimization problem for Jet-A and hydrogen with water recovery are shown in Tables \ref{tab:res_full_opt_JetA} and \ref{tab:res_full_opt_H2}, respectively.

% NOTE: PA - PA/AL replace this with a parallel axis plot?
% [ ] TODO: AL-PA, Yeah let's do the parallel axis plot for the basic thermodynamic parameters
% AL-PA, We can make another plot for the water fractions and the dpQp study.
% NOTE: PA-AL, currently working on this plot, Matplotlib scaling between parameters is being troublesome. Tried using Plotly but formatting documentation is scarce.
\begin{figure}[hbt!]
    \centering
    \includegraphics[width=0.8\textwidth]{N3_parallel_coords.pdf}
    \caption{Optimization results of the N+3 engine with and without no water recovery using Jet-A and H2 as the fuel.
        The red lines show Jet-A fuel and the blue lines show H2 fuel.
        The solid lines show the models without water recovery and the dashed lines show the models with water recovery.}
    \label{fig:parallel_coords}
\end{figure}

% \begin{table}[hbt!]
%     \centering
%     \caption{Optimization results of the N+3 engine with no water recovery using Jet-A as the fuel.
%     }
%     \small
%     \renewcommand{\arraystretch}{1.2}
%     \begin{tabular}{r l l l l l}
%                     & Variable/Function     & Value    & Lower  & Upper & Units           \\
%         \toprule
%         objective   & $TSEC_{\rm{CRZ}} $    & 8186.255 & -      & -     & $\frac{lbm}{s}$ \\
%         \hline
%         variables   & $PR_{fan,TOC}$        & 1.285    & 1.2    & 1.4   & -               \\
%                     & $PR_{LPC,TOC}$        & 4.000    & 2.5    & 4.0   & -               \\
%                     & $PR_{OPR,TOC}$        & 61.012   & 40.0   & 70.0  & -               \\
%                     & $T_{4,TOC}/T_{4,RTO}$ & 0.913    & 0.8    & 0.95  & -               \\
%                     & $T_{4,RTO}$           & 3220.570 & -      & -     & $^\circ$R       \\
%                     & $V_{ratio,CRZ}$       & 1.35     & 1.35   & 1.45  &                 \\
%         \hline
%         constraints & $F_{net,TOC}$         & 5800.0   & 5800.0 & -     & lbf             \\
%                     & $D_{Fan}$             & 100.0    & -      & 100   & $in^2$          \\
%         \bottomrule
%     \end{tabular}
%     \label{tab:res_thermo_opt_JetA}
% \end{table}

% \begin{table}[hbt!]
%     \centering
%     \caption{Optimization results of the N+3 engine with no water recovery using hydrogen as the fuel.
%     }
%     \small
%     \renewcommand{\arraystretch}{1.2}
%     \begin{tabular}{r l l l l l}
%                     & Variable/Function     & Value    & Lower  & Upper & Units           \\
%         \toprule
%         objective   & $TSEC_{\rm{CRZ}} $    & 8295.236 & -      & -     & $\frac{lbm}{s}$ \\
%         \hline
%         variables   & $PR_{fan,TOC}$        & 1.288    & 1.2    & 1.4   & -               \\
%                     & $PR_{LPC,TOC}$        & 4.000    & 2.5    & 4.0   & -               \\
%                     & $PR_{OPR,TOC}$        & 60.660   & 40.0   & 70.0  & -               \\
%                     & $T_{4,TOC}/T_{4,RTO}$ & 0.918    & 0.8    & 0.95  & -               \\
%                     & $T_{4,RTO}$           & 3204.07  & -      & -     & $^\circ$R       \\
%                     & $V_{ratio,CRZ}$       & 1.35     & 1.35   & 1.45  &                 \\
%         \hline
%         constraints & $F_{net,TOC}$         & 5800.0   & 5800.0 & -     & lbf             \\
%                     & $D_{Fan}$             & 100.0    & -      & 100   & $in^2$          \\
%         \bottomrule
%     \end{tabular}
%     \label{tab:res_thermo_opt_H2}
% \end{table}

% \begin{table}[hbt!]
%     \centering
%     \caption{Optimization results of the N+3 engine with water recovery using Jet-A as the fuel.
%     }
%     \small
%     \renewcommand{\arraystretch}{1.2}
%     \begin{tabular}{r l l l l l}
%                     & Variable/Function     & Value    & Lower  & Upper & Units           \\
%         \toprule
%         objective   & $TSEC_{\rm{CRZ}} $    & 7766.339 & -      & -     & $\frac{lbm}{s}$ \\
%         \hline
%         variables   & $x_{H2O,CRZ}$         & 0.3      & 0.0    & 0.3   & -               \\
%                     & $PR_{fan,TOC}$        & 1.292    & 1.2    & 1.4   & -               \\
%                     & $PR_{LPC,TOC}$        & 4.0      & 2.5    & 4.0   & -               \\
%                     & $PR_{OPR,TOC}$        & 61.188   & 40.0   & 70.0  & -               \\
%                     & $T_{4,TOC}/T_{4,RTO}$ & 0.911    & 0.8    & 0.95  & -               \\
%                     & $T_{4,RTO}$           & 3220.574 & -      & -     & $^\circ$R       \\
%                     & $V_{ratio,CRZ}$       & 1.35     & 1.35   & 1.45  &                 \\
%         \hline
%         constraints & $F_{net,TOC}$         & 5800.0   & 5800.0 & -     & lbf             \\
%                     & $D_{Fan}$             & 100.0    & -      & 100   & $in^2$          \\
%         \bottomrule
%     \end{tabular}
%     \label{tab:res_full_opt_JetA}
% \end{table}

% \begin{table}[hbt!]
%     \centering
%     \caption{Optimization results of the N+3 engine with water recovery using hydrogen as the fuel.
%     }
%     \small
%     \renewcommand{\arraystretch}{1.2}
%     \begin{tabular}{r l l l l l}
%                     & Variable/Function     & Value    & Lower  & Upper & Units           \\
%         \toprule
%         objective   & $TSEC_{\rm{CRZ}} $    & 7859.635 & -      & -     & $\frac{lbm}{s}$ \\
%         \hline
%         variables   & $x_{H2O,CRZ}$         & 0.17     & 0.0    & 0.17  & -               \\
%                     & $PR_{fan,TOC}$        & 1.297    & 1.2    & 1.4   & -               \\
%                     & $PR_{LPC,TOC}$        & 4.0      & 2.5    & 4.0   & -               \\
%                     & $PR_{OPR,TOC}$        & 61.952   & 40.0   & 70.0  & -               \\
%                     & $T_{4,TOC}/T_{4,RTO}$ & 0.916    & 0.8    & 0.95  & -               \\
%                     & $T_{4,RTO}$           & 3204.071 & -      & -     & $^\circ$R       \\
%                     & $V_{ratio,CRZ}$       & 1.35     & 1.35   & 1.45  &                 \\
%         \hline
%         constraints & $F_{net,TOC}$         & 5800.0   & 5800.0 & -     & lbf             \\
%                     & $D_{Fan}$             & 100.0    & -      & 100   & $in^2$          \\
%         \bottomrule
%     \end{tabular}
%     \label{tab:res_full_opt_H2}
% \end{table}

\begin{figure}[hbt!]
    \centering
    \includegraphics[width=0.8\textwidth]{JetA-H2_TSEC_diff.pdf}
    \caption{Percent relative improvement in thrust specific energy consumption (TSEC) of the N+3 engine with water recovery.
        This plot compares the relative improvement of the two optimziation problems with water recovery compared to the optimzation problems without water recovery.}
    \label{fig:barchart}
\end{figure}

The breakdown of thrust for each point is shown in Table \ref{tab:thrust}.
This table shows the resulting net thrust, gross thrust, and ram drag of each engine design for the four optimizations performed.

% Thrust splits
% [x] TODO: PA-PA: Add thrust splits for each opt
\begin{table}[hbt!]
    \centering
    \caption{Thrust breakdown for each flight operating condition.
        The net thrust, gross thrust, and ram drag are shown for each optimization result.
    }
    \small
    \renewcommand{\arraystretch}{1.2}
    \begin{tabular}{r l l l l l}
        Point & Parameter              & Jet-A Dry & Jet-A Wet & H2 Dry  & H2 Wet  \\
        \toprule
              & Net Thrust, \si{lbf}   & 5800.0    & 5800.0    & 5800.0  & 5800.0  \\
        TOC   & Ram Drag, \si{lbf}     & 19623.4   & 19623.4   & 19623.4 & 19623.4 \\
              & Gross Thrust, \si{lbf} & 25423.4   & 25423.4   & 25423.4 & 25423.4 \\
        \hline
              & Net Thrust, \si{lbf}   & 22800.0   & 22800.0   & 22800.0 & 22800.0 \\
        RTO   & Ram Drag, \si{lbf}     & 17089.7   & 17043.5   & 17070.8 & 17014.6 \\
              & Gross Thrust, \si{lbf} & 39889.7   & 39843.5   & 39870.8 & 39814.6 \\
        \hline
              & Net Thrust, \si{lbf}   & 28620.8   & 28620.8   & 28620.8 & 28620.8 \\
        SLS   & Ram Drag, \si{lbf}     & 61.8      & 61.7      & 61.8    & 61.6    \\
              & Gross Thrust, \si{lbf} & 28682.7   & 28682.5   & 28682.6 & 28682.4 \\
        \hline
              & Net Thrust, \si{lbf}   & 5220.0    & 5220.0    & 5220.0  & 5220.0  \\
        CRZ   & Ram Drag, \si{lbf}     & 19194.0   & 19152.9   & 19190.3 & 19144.1 \\
              & Gross Thrust, \si{lbf} & 24414.0   & 24372.9   & 24410.3 & 24364.1 \\
        \bottomrule
    \end{tabular}
    \label{tab:thrust}
\end{table}

% TSEC as a function of dPqP
\begin{figure}[hbt!]
    \centering
    \includegraphics[width=0.8\textwidth]{N3_dpqp.pdf}
    \caption{Pressure loss sweep of Duct5 which is just upstream of the water vapor extractor component.
        The figure shows the optimized TSEC values for varying levels of pressure loss due to the condensation of water compared to the optimzation problem without water recovery.
        This shows the working space available for designing a water condensor while still gaining the benefits of water recovery.}
    \label{fig:dpqp_sweep}
\end{figure}

\begin{figure}[hbt!]
    \centering
    \includegraphics[width=0.8\textwidth]{N3_wdot.pdf}
    \caption{Pressure loss sweep of Duct5 which is just upstream of the water vapor extractor component.
        The figure shows the resulting total available water in the exhaust stream for varying levels of pressure loss in the extractor flow path.
    }
    \label{fig:dpqp_wdot}
\end{figure}

% Motivation: space to work with hydrogen, benefits of water injection, benefits of H2 (a lot of water, no tanks, de-mineralized water)
\section{Conclusion}
\label{sec:conc}
% Message 1: Re-state the problem
% Message 2: Summarize the HBTF model
% Message 3: Expected results

\section{Acknowledgements}

\bibliography{mdolab,references}

\end{document}